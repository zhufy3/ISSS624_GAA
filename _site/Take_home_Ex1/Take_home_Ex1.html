<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.189">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Fangyuan ZHU">

<title>ISSS624GAA - Take Home Exercise 1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">ISSS624GAA</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false">Hands-on Exercises</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-exercises">    
        <li>
    <a class="dropdown-item" href="../Hands_on_Ex1/Hands_on_Ex1.html">
 <span class="dropdown-text">Hands-on Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands_on_Ex2/Hands_on_Ex2.html">
 <span class="dropdown-text">Hands-on Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands_on_Ex3/Hands_on_Ex3.html">
 <span class="dropdown-text">Hands_on Exercise 3</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-inclass-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false">Inclass Exercises</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-inclass-exercises">    
        <li>
    <a class="dropdown-item" href="../Inclass_Ex1/Inclass_Ex1.html">
 <span class="dropdown-text">Inclass Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Inclass_Ex2/Inclass_Ex2.html">
 <span class="dropdown-text">Inclass Exercise 2</span></a>
  </li>  
        <li>
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
    <a class="dropdown-item" href="../Inclass_Ex3/Inclass_Ex3.html">
=======
    <a class="dropdown-item" href="../Inclass_Ex2/Inclass_Ex3.qmd">
>>>>>>> e7032b81eca7edfb1480d90cf27d0198ced4a2b8
=======
    <a class="dropdown-item" href="../Inclass_Ex2/Inclass_Ex3.qmd">
>>>>>>> e7032b81eca7edfb1480d90cf27d0198ced4a2b8
=======
    <a class="dropdown-item" href="../Inclass_Ex2/Inclass_Ex3.qmd">
>>>>>>> e7032b81eca7edfb1480d90cf27d0198ced4a2b8
=======
    <a class="dropdown-item" href="../Inclass_Ex2/Inclass_Ex3.qmd">
>>>>>>> e7032b81eca7edfb1480d90cf27d0198ced4a2b8
 <span class="dropdown-text">Inclass Exercise 3</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-take-home-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false">Take Home Exercises</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-take-home-exercises">    
        <li>
    <a class="dropdown-item" href="../Take_home_Ex1/Take_home_Ex1.html">
 <span class="dropdown-text">Take Home Exercise 1</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-r4dsa-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false">R4DSA Exercises</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-r4dsa-exercises">    
        <li class="dropdown-header">R4DSA Exercise 1</li>
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html">Home</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html">About the author</a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Take Home Exercise 1</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Fangyuan ZHU </p>
          </div>
  </div>
    
    
  </div>
  

</header>

<section id="geospatial-analysis-for-water-points-in-nigeria" class="level1">
<h1>Geospatial Analysis for Water Points in Nigeria</h1>
<section id="background-of-the-analysis" class="level2">
<h2 class="anchored" data-anchor-id="background-of-the-analysis">Background of the analysis</h2>
<p>Water is the source of life on the Earth. Clean and accessible water is particularly critical for human life. Yet over 40% of the global population does not have access to sufficient clean water. Scarcity of water supply is a intractable problem to be solved in the world.</p>
</section>
<section id="objectives" class="level2">
<h2 class="anchored" data-anchor-id="objectives">Objectives</h2>
<p>The main aim of this project is to use water point related data from rural areas at the water point or small water scheme level and share the data via WPdx Data Repository. In order to address this complex problem, we focus on <strong>Nigeria</strong> as a study case and analyse the spatial distribution attributes of <strong><em>Not Functional Water Point</em></strong> in this project.</p>
</section>
<section id="data-used" class="level2">
<h2 class="anchored" data-anchor-id="data-used">1. Data used</h2>
<p>The data used in this project consists of two types:</p>
<ul>
<li><p>aspatial data from <a href="https://www.waterpointdata.org/access-data/">WPdx Global Data Repositories</a></p></li>
<li><p>geospatial data of Nigeria Level-2 Administrative Boundary (also known as Local Government Area) polygon features GIS data.</p></li>
</ul>
</section>
<section id="packages-used" class="level2">
<h2 class="anchored" data-anchor-id="packages-used">2. Packages used</h2>
<p>In this project, packages below are used to facilitate our analysis.</p>
<ul>
<li><p>sf</p></li>
<li><p>tidyverse</p></li>
<li><p>tamp</p></li>
<li><p>spdep</p></li>
<li><p>funModeling</p></li>
<li><p>knitr</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(sf,tidyverse,tmap,spdep,funModeling,knitr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ul>
</section>
<section id="importing-data-into-r-environment" class="level2">
<h2 class="anchored" data-anchor-id="importing-data-into-r-environment">3. Importing data into R environment</h2>
<p>The data belonging to Nigeria should be extracted from the shapefiles <em>geo_export.</em> We use <strong><em>Projected</em></strong> <strong><em>Coordinate System</em></strong> whose identifier of EPSG is <strong>26391</strong>, so the <em>crs</em> = 26391. The function <em>st_read</em> of <em>sf</em> package is used to save the data in a simple feature data table. The data has been filtered when downloaded so no filter by <em>Nigeria</em> will be used here.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>wp <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"geodata"</span>,</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">layer =</span> <span class="st">"geo_export"</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">crs =</span> <span class="dv">26391</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>From the description above,</p>
<ul>
<li><p>the data has 95008 features and 72 fields</p></li>
<li><p>Geometry type is POINT</p></li>
<li><p>Coordinate system is Projected System Minna/Nigeria west Belt</p></li>
</ul>
<p>Then we upload the extracted tidy data table into the data file <em>geodata.</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(wp,<span class="st">"geodata/wp_nga.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we import Nigeria LGA boundary data into R environment using the same function, and also extract Projected Coordinate System to match the water point data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>nga <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"geodata"</span>,</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">layer =</span> <span class="st">"geoBoundaries-NGA-ADM2"</span>,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">crs =</span> <span class="dv">26391</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>From the description above,</p>
<ul>
<li><p>Geometry type of the data is MULTIPOLYGON</p></li>
<li><p>Coordinate system is Projected System Minna/Nigeria west Belt</p></li>
</ul>
</section>
<section id="data-wrangling" class="level2">
<h2 class="anchored" data-anchor-id="data-wrangling">4. Data Wrangling</h2>
<section id="data-issues" class="level3">
<h3 class="anchored" data-anchor-id="data-issues">4.1 Data Issues</h3>
<section id="missing-value-check" class="level4">
<h4 class="anchored" data-anchor-id="missing-value-check">4,1,1 Missing Value Check</h4>
<p>First let us check if there are missing values in the extracted data tables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nga[<span class="fu">rowSums</span>(<span class="fu">is.na</span>(nga))<span class="sc">!=</span><span class="dv">0</span>,])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As we can see the summary information above, there is no missing value in LGA boundary data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(wp[<span class="fu">rowSums</span>(<span class="fu">is.na</span>(wp))<span class="sc">!=</span><span class="dv">0</span>,])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As we can see from information above, there are so many missing values in the water point data. For example, there are 94994 missing values in <em>clean_adm4,</em> 46891 missing values in <em>install_ye</em>, and so on.</p>
</section>
<section id="recoding-missing-values-into-strings" class="level4">
<h4 class="anchored" data-anchor-id="recoding-missing-values-into-strings">4.1.2 Recoding Missing Values into Strings</h4>
<p>Next, we recode these missing values of <em>status_cle</em>, which we will use in the subsequent analysis into <em>“Unknown”</em> to proceed our analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>wp_nga <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"geodata/wp_nga.rds"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">status_cle =</span> <span class="fu">replace_na</span>(status_cle, <span class="st">"Unknown"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="data-processing" class="level3">
<h3 class="anchored" data-anchor-id="data-processing">4.2 Data Processing</h3>
<section id="glimpse-the-data-tables" class="level4">
<h4 class="anchored" data-anchor-id="glimpse-the-data-tables">4.2.1 Glimpse The Data Tables</h4>
<p>We take a check at our data tables with <em>glimpse()</em> of <em>dplyr</em> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(nga)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can see that the table has 774 rows and 6 columns, which are in <em>character</em> and <em>multipolygon</em> classes.</p>
<ul>
<li><p><em>shapename</em></p></li>
<li><p><em>Level</em></p></li>
<li><p><em>shapeID</em></p></li>
<li><p><em>shapeGroup</em></p></li>
<li><p><em>shapeType</em></p></li>
<li><p><em>geometry.</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(wp_nga)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ul>
<p>We can see that the table has 95008 rows and 73 columns.</p>
<p>Then let us have a quick look at the geometry of the geospatioal data by using <em>plot()</em> and <em>st_geometry()</em> of <em>sf</em> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(nga))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/000005.png" class="img-fluid"></p>
</section>
<section id="distribution-of-the-data-in-status_cle-field" class="level4">
<h4 class="anchored" data-anchor-id="distribution-of-the-data-in-status_cle-field">4.2.2 Distribution of The Data in <em>status_cle</em> Field</h4>
<p>Then we can display the distribution of the data in <em>status_cle</em> field using <em>freq().</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">freq</span>(<span class="at">data=</span>wp_nga, </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">input =</span> <span class="st">'status_cle'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/000011.png" class="img-fluid"></p>
<p>From the hist graph, it is shown that <strong><em>Functional Water Point</em></strong> takes the most portion of <strong>48.29 %</strong> within the <em>status_cle</em> field. Next is <em><strong>Non-Functional Water Point</strong>,</em> our objective analysed in this project, which takes <strong>30.93%</strong> in the field.</p>
</section>
<section id="points-in-polygons" class="level4">
<h4 class="anchored" data-anchor-id="points-in-polygons">4.2.3 Points in Polygons</h4>
<p>We first extract <em>Functional</em> water point, on which we focus to analyse, from the whole <em>status_cle</em> field, and write the simple feature data table into <em>rds</em> files.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>wpt_functional <span class="ot">&lt;-</span> wp_nga <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(status_cle <span class="sc">%in%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">c</span>(<span class="st">"Functional"</span>, </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Functional but needs repair"</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Functional but not in use"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can check the proportion of each attribute in <em>Functional Water Point</em> as shown below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">freq</span>(<span class="at">data=</span>wpt_functional, </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">input =</span> <span class="st">'status_cle'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/000010.png" class="img-fluid"></p>
<p>We then extract <em>Non-Functional</em> water point from the whole <em>status_cle</em> field, and write the simple feature data table into <em>rds</em> files.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>wpt_nonfunctional <span class="ot">&lt;-</span> wp_nga <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(status_cle <span class="sc">%in%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">c</span>(<span class="st">"Abandoned/Decommissioned"</span>, </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Abandoned"</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Non-Functional"</span>,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Non functional due to dry season"</span>,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Non-Functional due to dry season"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can check the proportion of each attribute in <em>Non-Functional Water Point</em> as shown below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">freq</span>(<span class="at">data=</span>wpt_nonfunctional, </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">input =</span> <span class="st">'status_cle'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/000010-01.png" class="img-fluid"></p>
<p>Now we count the number of <em>Total,</em> <em>Functional</em> and <em>Non-Functional</em> water points at LGA level using <em>st_intersects()</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>FC<span class="ot">&lt;-</span> <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(nga, wpt_nonfunctional))</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>NFC<span class="ot">&lt;-</span> <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(nga, wpt_functional))</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>TL<span class="ot">&lt;-</span><span class="fu">lengths</span>(<span class="fu">st_intersects</span>(nga, wp_nga))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We merge the count of <em>Total Water Point, Functional Water Point</em> and <em>Non-Functional Water Point</em> in polygons with LGA data table <em>nga</em> as <em>nga_wp.</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>nga_wp <span class="ot">&lt;-</span> nga <span class="sc">%&gt;%</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">total wpt</span><span class="st">`</span> <span class="ot">=</span> TL) <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">wpt functional</span><span class="st">`</span> <span class="ot">=</span> FC) <span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">wpt non-functional</span><span class="st">`</span> <span class="ot">=</span> NFC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then we calculate the portion of numbers of functional and non-functional water points in each polygon, and merge it with <em>nga</em> data table.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>nga_wp <span class="ot">&lt;-</span> nga_wp <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pct_functional =</span> <span class="st">`</span><span class="at">wpt functional</span><span class="st">`</span><span class="sc">/</span><span class="st">`</span><span class="at">total wpt</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">pct_non-functional</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">wpt non-functional</span><span class="st">`</span><span class="sc">/</span><span class="st">`</span><span class="at">total wpt</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we save the data table into <em>rds</em> format with the chunk below. And delete other raw data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(nga_wp, <span class="st">"geodata/nga_wp.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="geospatial-analysis" class="level3">
<h3 class="anchored" data-anchor-id="geospatial-analysis">5. Geospatial Analysis</h3>
<section id="visualizing-water-point-indicator" class="level4">
<h4 class="anchored" data-anchor-id="visualizing-water-point-indicator">5.1 Visualizing Water Point Indicator</h4>
<p>Now we can visualize the distributions of proportions of <em>Functional</em> and <em>Non-Functional water point</em> using <em>ggplot2</em> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>nga_wp <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"geodata/nga_wp.rds"</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>nga_wp, </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span> <span class="fu">as.numeric</span>(<span class="st">`</span><span class="at">pct_non-functional</span><span class="st">`</span>)))<span class="sc">+</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">20</span>, </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color=</span><span class="st">"black"</span>, </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill=</span><span class="st">"light blue"</span>) <span class="sc">+</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Are non-functional water points even distributed in Nigeria?"</span>,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Non-Functional Water Points Proportion"</span>,</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Frequency"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take_home_Ex1_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can see that the distribution of percentage of non-functional water point is similar to normal distribution, with little skewness.</p>
<p>Now, we are going to prepare a basemap and a choropleth map showing the distribution of <em>Non-Functional</em> water point by using <em>qtm()</em> of <strong>tmap</strong> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>equal <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(nga_wp) <span class="sc">+</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"wpt non-functional"</span>,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">n =</span> <span class="dv">5</span>,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"equal"</span>) <span class="sc">+</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Equal interval classification"</span>,</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.outside =</span> <span class="cn">TRUE</span>,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.height =</span> <span class="fl">0.45</span>, </span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">5.0</span>,</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"bottom"</span>),</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>quantile <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(nga_wp) <span class="sc">+</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"wpt non-functional"</span>,</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>          <span class="at">n =</span> <span class="dv">5</span>,</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"quantile"</span>) <span class="sc">+</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Equal quantile classification"</span>,</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.outside =</span> <span class="cn">TRUE</span>,</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.height =</span> <span class="fl">0.45</span>, </span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">5.0</span>,</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"bottom"</span>),</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(equal, </span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>             quantile, </span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>             <span class="at">asp=</span><span class="dv">1</span>, </span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take_home_Ex1_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="global-spatial-autocorrelation" class="level3">
<h3 class="anchored" data-anchor-id="global-spatial-autocorrelation">6 Global Spatial Autocorrelation</h3>
<p>Before we can compute the global spatial autocorrelation statistics, we need to construct a spatial weights of the study area. The polygon contiguity method is effective when polygons are similar in size and distribution, and when spatial relationships are a function of polygon proximity.</p>
<p>The <strong>fixed distance method</strong> works well for point data. It is often a good option for polygon data when there is a <strong>large variation</strong> in polygon size. Because we have had a quick look at the geometry, the variation in polygon size is quite large, and the distribution of the indicator <strong>is not largely skewed</strong>, so we choose fixed distance matrix.</p>
<section id="computing-contiguity-based-on-fixed-distance" class="level4">
<h4 class="anchored" data-anchor-id="computing-contiguity-based-on-fixed-distance">6.1 Computing Contiguity Based on Fixed Distance</h4>
<section id="determine-the-cut-off-distance" class="level5">
<h5 class="anchored" data-anchor-id="determine-the-cut-off-distance">6.1.1 Determine the cut-off distance</h5>
<p>To get our longitude values we map the st_centroid function over the geometry column of us.bound and access the longitude value through double bracket notation [[]] and 1. This allows us to get only the longitude, which is the first value in each centroid.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>longitude <span class="ot">&lt;-</span> <span class="fu">map_dbl</span>(nga_wp<span class="sc">$</span>geometry, <span class="sc">~</span><span class="fu">st_centroid</span>(.x)[[<span class="dv">1</span>]])</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>latitude <span class="ot">&lt;-</span> <span class="fu">map_dbl</span>(nga_wp<span class="sc">$</span>geometry, <span class="sc">~</span><span class="fu">st_centroid</span>(.x)[[<span class="dv">2</span>]])</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">cbind</span>(longitude, latitude)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(coords)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     longitude  latitude
[1,]  7.372450  5.113107
[2,]  7.352131  5.083219
[3,] 13.322900 13.428835
[4,]  6.847325  8.825812
[5,]  7.771541  5.022061
[6,]  8.219654  6.259845</code></pre>
</div>
</div>
<p>Then, we need to determine the upper limit for distance band by using the steps below:</p>
<ul>
<li><p>Return a matrix with the indices of points belonging to the set of the k nearest neighbours of each other by using <a href="https://r-spatial.github.io/spdep/reference/knearneigh.html"><em>knearneigh()</em></a> of <strong>spdep</strong>.</p></li>
<li><p>Convert the knn object returned by <em>knearneigh()</em> into a neighbours list of class nb with a list of integer vectors containing neighbour region number ids by using <a href="https://r-spatial.github.io/spdep/reference/knn2nb.html"><em>knn2nb()</em></a>.</p></li>
<li><p>Return the length of neighbour relationship edges by using <a href="https://r-spatial.github.io/spdep/reference/nbdists.html"><em>nbdists()</em></a> of <strong>spdep</strong>. The function returns in the units of the coordinates if the coordinates are projected, in km otherwise.</p></li>
</ul>
<p>Remove the list structure of the returned object by using <a href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/unlist"><strong>unlist()</strong></a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>k1 <span class="ot">&lt;-</span> <span class="fu">knn2nb</span>(<span class="fu">knearneigh</span>(coords))</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>k1dists <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">nbdists</span>(k1, coords, <span class="at">longlat =</span> <span class="cn">TRUE</span>))</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(k1dists)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  2.662  12.815  20.242  22.031  27.706  71.661 </code></pre>
</div>
</div>
<p>The summary report shows that the largest nearest neighbour distance is <strong>71.661 km</strong>, and the least nearest neighbour distance is <strong>2.662 km,</strong> so using this as the upper threshold gives certainty that all units will have at least one neighbour.</p>
</section>
<section id="computing-fixed-distance-weight-matrix" class="level5">
<h5 class="anchored" data-anchor-id="computing-fixed-distance-weight-matrix">6.1.2 Computing fixed distance weight matrix</h5>
<p>Now, we will compute the distance weight matrix by using <em>dnearneigh()</em> as shown in the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>wm_d72 <span class="ot">&lt;-</span> <span class="fu">dnearneigh</span>(coords, <span class="dv">0</span>, <span class="dv">72</span>, <span class="at">longlat =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>wm_d72</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 774 
Number of nonzero links: 18112 
Percentage nonzero weights: 3.023323 
Average number of links: 23.40052 </code></pre>
</div>
</div>
<p>We can display the content of the matrix by using <em>str()</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(wm_d72)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 774
 $ : int [1:63] 2 5 10 25 55 66 68 103 122 181 ...
 $ : int [1:62] 1 5 10 25 55 66 68 103 122 181 ...
 $ : int [1:2] 261 447
 $ : int [1:10] 12 20 257 263 446 454 466 641 690 695
 $ : int [1:56] 1 2 55 66 104 136 137 169 184 202 ...
 $ : int [1:21] 9 14 18 19 56 170 217 218 330 337 ...
 $ : int [1:19] 8 15 22 176 177 214 281 282 283 295 ...
 $ : int [1:32] 7 15 22 49 176 177 214 275 276 277 ...
 $ : int [1:26] 6 18 19 56 66 77 103 104 217 218 ...
 $ : int [1:63] 1 2 23 25 66 103 181 191 203 204 ...
 $ : int [1:22] 26 27 43 68 126 157 190 191 204 336 ...
 $ : int [1:11] 4 135 257 263 401 417 429 446 454 690 ...
 $ : int [1:13] 31 37 38 40 94 211 320 393 436 471 ...
 $ : int [1:24] 6 170 193 194 195 217 309 310 311 362 ...
 $ : int [1:27] 7 8 22 32 49 51 62 82 176 177 ...
 $ : int [1:37] 30 38 39 41 44 45 70 71 120 124 ...
 $ : int [1:34] 28 29 35 72 172 173 178 179 182 275 ...
 $ : int [1:29] 6 9 19 56 66 77 103 104 217 218 ...
 $ : int [1:41] 6 9 18 25 56 66 77 103 104 181 ...
 $ : int [1:7] 4 106 239 263 419 454 466
 $ : int [1:9] 60 61 162 269 484 520 578 596 626
 $ : int [1:31] 7 8 15 32 49 51 62 82 176 177 ...
 $ : int [1:64] 10 25 52 53 54 56 58 77 78 79 ...
 $ : int [1:5] 123 476 527 673 761
 $ : int [1:68] 1 2 10 19 23 54 56 66 77 103 ...
 $ : int [1:30] 11 27 43 68 157 190 191 204 336 370 ...
 $ : int [1:24] 11 26 43 68 157 191 204 336 370 371 ...
 $ : int [1:43] 17 29 35 70 71 124 172 173 178 179 ...
 $ : int [1:45] 17 28 35 70 71 124 172 173 178 179 ...
 $ : int [1:30] 16 38 39 40 41 44 45 175 185 186 ...
 $ : int [1:13] 13 37 94 158 210 211 212 289 308 561 ...
 $ : int [1:28] 15 22 49 51 62 82 177 196 207 214 ...
 $ : int [1:29] 47 111 130 142 145 155 166 219 227 233 ...
 $ : int [1:11] 42 86 104 136 137 213 375 553 559 733 ...
 $ : int [1:32] 17 28 29 172 173 178 179 182 275 276 ...
 $ : int [1:8] 50 107 247 408 432 455 681 759
 $ : int [1:21] 13 31 38 39 40 41 186 192 197 198 ...
 $ : int [1:25] 13 16 30 37 39 40 41 44 186 192 ...
 $ : int [1:27] 16 30 37 38 40 41 44 185 186 192 ...
 $ : int [1:21] 13 30 37 38 39 41 44 186 192 211 ...
 $ : int [1:22] 16 30 37 38 39 40 44 45 186 192 ...
 $ : int [1:20] 34 86 136 137 184 202 285 286 375 499 ...
 $ : int [1:19] 11 26 27 68 122 126 157 190 191 246 ...
 $ : int [1:27] 16 30 38 39 40 41 45 70 175 186 ...
 $ : int [1:27] 16 30 41 44 70 175 187 188 192 290 ...
 $ : int [1:12] 119 380 387 417 423 429 438 459 521 656 ...
 $ : int [1:24] 33 111 127 130 155 166 227 234 238 242 ...
 $ : int [1:12] 64 65 74 113 131 265 386 407 428 482 ...
 $ : int [1:30] 8 15 22 32 51 62 82 176 177 207 ...
 $ : int [1:4] 36 107 409 432
 $ : int [1:27] 15 22 32 49 62 82 177 207 214 284 ...
 $ : int [1:47] 23 53 54 57 58 77 78 79 80 165 ...
 $ : int [1:37] 23 52 54 57 58 78 79 80 165 189 ...
 $ : int [1:58] 23 25 52 53 56 57 58 77 78 79 ...
 $ : int [1:33] 1 2 5 68 122 157 169 184 190 208 ...
 $ : int [1:51] 6 9 18 19 23 25 54 66 77 78 ...
 $ : int [1:34] 52 53 54 58 78 79 80 165 189 197 ...
 $ : int [1:37] 23 52 53 54 57 78 79 165 189 197 ...
 $ : int [1:5] 128 129 493 700 748
 $ : int [1:14] 21 61 158 269 310 311 561 563 578 589 ...
 $ : int [1:11] 21 60 162 268 269 484 578 589 592 596 ...
 $ : int [1:28] 15 22 32 49 51 82 177 196 207 214 ...
 $ : int [1:5] 384 416 467 765 772
 $ : int [1:7] 48 65 74 113 131 265 407
 $ : int [1:11] 48 64 74 109 113 265 386 407 683 701 ...
 $ : int [1:47] 1 2 5 9 10 18 19 25 56 103 ...
 $ : int [1:25] 72 120 124 179 182 304 305 346 347 348 ...
 $ : int [1:30] 1 2 11 26 27 43 55 122 157 190 ...
 $ : int [1:8] 140 146 248 274 473 500 512 513
 $ : int [1:44] 16 28 29 44 45 71 120 124 172 173 ...
 $ : int [1:49] 16 28 29 70 120 124 172 173 175 178 ...
 $ : int [1:18] 17 67 182 361 374 378 404 566 567 568 ...
 $ : int [1:6] 361 374 377 404 665 666
 $ : int [1:14] 48 64 65 109 113 116 251 265 672 683 ...
 $ : int [1:15] 110 229 255 258 272 373 382 398 422 433 ...
 $ : int [1:9] 254 287 427 459 470 547 647 677 751
 $ : int [1:55] 9 18 19 23 25 52 54 56 78 79 ...
 $ : int [1:51] 23 52 53 54 56 57 58 77 79 80 ...
 $ : int [1:57] 23 52 53 54 56 57 58 77 78 80 ...
 $ : int [1:39] 23 52 53 54 57 77 78 79 165 189 ...
 $ : int [1:19] 99 145 227 233 242 255 270 426 449 483 ...
 $ : int [1:21] 15 22 32 49 51 62 177 207 214 297 ...
 $ : int [1:6] 132 258 383 414 529 767
 $ : int [1:3] 148 437 692
 $ : int [1:38] 101 105 130 142 145 155 156 219 235 242 ...
 $ : int [1:17] 34 42 136 137 184 202 285 286 499 538 ...
 $ : int [1:19] 147 149 151 221 226 245 267 399 410 415 ...
 $ : int [1:5] 150 489 648 700 714
 $ : int [1:12] 100 107 159 260 408 458 463 542 674 676 ...
 $ : int 237
 $ : int [1:3] 160 271 406
 $ : int [1:11] 95 119 390 391 392 423 487 642 656 668 ...
 $ : int [1:3] 354 607 665
 $ : int [1:7] 13 31 158 436 561 596 709
 $ : int [1:10] 92 390 391 392 405 423 469 656 708 770
 $ : int [1:17] 97 108 139 167 168 350 389 403 412 420 ...
 $ : int [1:13] 96 108 114 139 147 168 389 403 420 451 ...
 $ : int [1:4] 153 231 432 696
 $ : int [1:18] 81 145 154 167 227 233 255 270 426 449 ...
  [list output truncated]
 - attr(*, "class")= chr "nb"
 - attr(*, "region.id")= chr [1:774] "1" "2" "3" "4" ...
 - attr(*, "call")= language dnearneigh(x = coords, d1 = 0, d2 = 72, longlat = TRUE)
 - attr(*, "dnn")= num [1:2] 0 72
 - attr(*, "bounds")= chr [1:2] "GE" "LE"
 - attr(*, "nbtype")= chr "distance"
 - attr(*, "sym")= logi TRUE</code></pre>
</div>
</div>
</section>
<section id="plotting-distance-based-neighbours" class="level5">
<h5 class="anchored" data-anchor-id="plotting-distance-based-neighbours">6.1.3 Plotting distance based neighbours</h5>
<p>Let us now plot the weight matrix using the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(nga_wp<span class="sc">$</span>geometry, <span class="at">border=</span><span class="st">"lightgrey"</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wm_d72,<span class="at">add=</span><span class="cn">TRUE</span>, coords)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(k1, coords, <span class="at">add=</span><span class="cn">TRUE</span>, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">length=</span><span class="fl">0.08</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take_home_Ex1_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The red lines show the links of 1st nearest neighbours and the black lines show the links of neighbours within the cut-off distance of 72km.</p>
<p>Next, we need to assign weights to each neighboring polygon based both on <em>Fixed Distance</em>. In our case, each neighboring polygon will be assigned equal weight (style=“W”).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>rswm_f <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(wm_d72, </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">style=</span><span class="st">"W"</span>, </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rswm_f,  <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Characteristics of weights list object:
Neighbour list object:
Number of regions: 774 
Number of nonzero links: 18112 
Percentage nonzero weights: 3.023323 
Average number of links: 23.40052 

Weights style: W 
Weights constants summary:
    n     nn  S0       S1       S2
W 774 599076 774 129.7549 3127.064</code></pre>
</div>
</div>
</section>
</section>
<section id="global-spatial-autocorrelation-test" class="level4">
<h4 class="anchored" data-anchor-id="global-spatial-autocorrelation-test">6.2 Global Spatial Autocorrelation Test</h4>
<p>The Null Hypothesis for Spatial Randomness:</p>
<ul>
<li><p>Observed spatial pattern of values is equally likely as any other spatial pattern.</p></li>
<li><p>Values at one location do not depend on values at other (neighbouring) locations.</p></li>
<li><p>Under spatial randomness, the location of values may be altered without affecting the information content of the data.</p>
<p>We mainly have two methods to test the teospatial global autocorrelation.</p></li>
<li><p>Moran’s I Test</p></li>
<li><p>Geary’s C Test</p></li>
</ul>
<section id="morans-i-test" class="level5">
<h5 class="anchored" data-anchor-id="morans-i-test">6.2.1 Moran’s I Test</h5>
<p>As the snippet shows, there are some percentage becomes <em>NaN</em> because the <em>total wpt</em> is 0. We should recode these NA as 0.</p>
<p><img src="images/tempsnip.png" class="img-fluid"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>nga_wp <span class="ot">&lt;-</span> nga_wp <span class="sc">%&gt;%</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pct_functional =</span> <span class="fu">replace_na</span>(pct_functional,<span class="dv">0</span>))<span class="sc">%&gt;%</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">pct_non-functional</span><span class="st">`</span><span class="ot">=</span><span class="fu">replace_na</span>(<span class="st">`</span><span class="at">pct_non-functional</span><span class="st">`</span>,<span class="dv">0</span>))</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(nga_wp,<span class="st">"geodata/nga_wp.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The code chunk below performs Moran’s I statistical testing using <em>moran.test()</em> of <strong>spdep</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">moran.test</span>(nga_wp<span class="sc">$</span><span class="st">`</span><span class="at">pct_non-functional</span><span class="st">`</span>, </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">listw=</span>rswm_f, </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">zero.policy =</span> <span class="cn">TRUE</span>, </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">na.action=</span>na.omit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  nga_wp$`pct_non-functional`  
weights: rswm_f    

Moran I statistic standard deviate = 33.537, p-value &lt; 2.2e-16
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
     0.4885731483     -0.0012936611      0.0002133515 </code></pre>
</div>
</div>
<p>From the summary of the test result, we can see that the <strong>p-value</strong> is less than <strong>0.05</strong>, which means we have evident reasons to reject the Null Hypothesis that the percentage of Non-Functional water point is randomly distributed across the country.</p>
</section>
<section id="computing-monte-carlo-morans-i" class="level5">
<h5 class="anchored" data-anchor-id="computing-monte-carlo-morans-i">6.2.2 Computing Monte Carlo Moran’s I</h5>
<p>We already get the result of the Moran’s I Test, but we can confirm the test by simulating Monte Carlo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>bperm<span class="ot">=</span> <span class="fu">moran.mc</span>(nga_wp<span class="sc">$</span><span class="st">`</span><span class="at">pct_non-functional</span><span class="st">`</span>, </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">listw=</span>rswm_f, </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">nsim=</span><span class="dv">999</span>, </span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">zero.policy =</span> <span class="cn">TRUE</span>, </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">na.action=</span>na.omit)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>bperm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Monte-Carlo simulation of Moran I

data:  nga_wp$`pct_non-functional` 
weights: rswm_f  
number of simulations + 1: 1000 

statistic = 0.48857, observed rank = 1000, p-value = 0.001
alternative hypothesis: greater</code></pre>
</div>
</div>
<p>From the summary of the test result, we can see that the <strong>p-value</strong> is <strong>0.001,</strong> still less than <strong>0.05</strong>, which means we have evident reasons to reject the Null Hypothesis that the percentage of Non-Functional water point is randomly distributed across the country. And the <strong>statistic = 0.48857 &gt;0.</strong> For the <strong>I statistic,</strong> if it is positive (I&gt;0): Clustered, observations tend to be similar.</p>
</section>
<section id="gearys-c-test" class="level5">
<h5 class="anchored" data-anchor-id="gearys-c-test">6.2.3 Geary’s C Test</h5>
<p>The code chunk below performs Geary’s C test for spatial autocorrelation by using <a href="https://r-spatial.github.io/spdep/reference/geary.test.html"><em>geary.test()</em></a> of <strong>spdep</strong>.</p>
<p>Now we can do the Geary’s C test:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">geary.test</span>(nga_wp<span class="sc">$</span><span class="st">`</span><span class="at">pct_non-functional</span><span class="st">`</span>, <span class="at">listw=</span>rswm_f, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Geary C test under randomisation

data:  nga_wp$`pct_non-functional` 
weights: rswm_f 

Geary C statistic standard deviate = 32.308, p-value &lt; 2.2e-16
alternative hypothesis: Expectation greater than statistic
sample estimates:
Geary C statistic       Expectation          Variance 
     0.5091973810      1.0000000000      0.0002307798 </code></pre>
</div>
</div>
<p>From the summary of the test result, we can see that the <strong>p-value</strong> is less than <strong>0.05</strong>, which means we have evident reasons to reject the Null Hypothesis that the percentage of Non-Functional water point is randomly distributed across the country. The <strong>Geary C statistic = 0.5091973810 &lt; 1.</strong></p>
</section>
<section id="computing-monte-carlo-gearys-c" class="level5">
<h5 class="anchored" data-anchor-id="computing-monte-carlo-gearys-c">6.2.4 Computing Monte Carlo Geary’s C</h5>
<p>The code chunk below performs permutation test for Geary’s C statistic by using <a href="https://r-spatial.github.io/spdep/reference/geary.mc.html"><em>geary.mc()</em></a> of <strong>spdep</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>bperm<span class="ot">=</span><span class="fu">geary.mc</span>(nga_wp<span class="sc">$</span><span class="st">`</span><span class="at">pct_non-functional</span><span class="st">`</span>, </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">listw=</span>rswm_f, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>,</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">nsim=</span><span class="dv">999</span>)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>bperm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Monte-Carlo simulation of Geary C

data:  nga_wp$`pct_non-functional` 
weights: rswm_f 
number of simulations + 1: 1000 

statistic = 0.5092, observed rank = 1, p-value = 0.001
alternative hypothesis: greater</code></pre>
</div>
</div>
<p>From the summary of the test result, we can see that the <strong>p-value</strong> is <strong>0.001,</strong> still less than <strong>0.05</strong>, which means we have evident reasons to reject the Null Hypothesis that the percentage of Non-Functional water point is randomly distributed across the country. And the <strong>statistic = 0.5092 &lt; 1.</strong> For the <strong>c statistic,</strong> if it is Small c value (&lt;1) : Clustered, observations tend to be similar.</p>
</section>
</section>
<section id="clusters-and-outliers-analysis" class="level4">
<h4 class="anchored" data-anchor-id="clusters-and-outliers-analysis">6.3 Clusters and Outliers Analysis</h4>
<section id="computing-local-morans-i" class="level5">
<h5 class="anchored" data-anchor-id="computing-local-morans-i">6.3.1 Computing local Moran’s I</h5>
<p>The code chunks below are used to compute local Moran’s I of <em>pct_non-functional</em> at the ADM2 level.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>fips <span class="ot">&lt;-</span> <span class="fu">order</span>(nga_wp<span class="sc">$</span>shapeName)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>localMI <span class="ot">&lt;-</span> <span class="fu">localmoran</span>(nga_wp<span class="sc">$</span><span class="st">`</span><span class="at">pct_non-functional</span><span class="st">`</span>, rswm_f,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(localMI)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           Ii          E.Ii       Var.Ii      Z.Ii Pr(z != E(Ii))
1  0.12294172 -1.660246e-04 0.0018756062  2.842592   4.474830e-03
2  0.12080225 -1.789636e-04 0.0020572566  2.667311   7.646083e-03
3  4.24438429 -5.490795e-03 2.1105325510  2.925366   3.440518e-03
4 -0.13148405 -1.991603e-04 0.0152322650 -1.063733   2.874498e-01
5  0.05500367 -8.206875e-06 0.0001053487  5.359718   8.335186e-08
6  0.30571432 -4.743753e-04 0.0170230816  2.346767   1.893707e-02</code></pre>
</div>
</div>
<p><em>localmoran()</em> function returns a matrix of values whose columns are:</p>
<ul>
<li><p>Ii: the local Moran’s I statistics</p></li>
<li><p>E.Ii: the expectation of local moran statistic under the randomisation hypothesis</p></li>
<li><p>Var.Ii: the variance of local moran statistic under the randomisation hypothesis</p></li>
<li><p>Z.Ii:the standard deviate of local moran statistic</p></li>
<li><p>Pr(): the p-value of local moran statistic</p></li>
</ul>
</section>
<section id="mapping-the-local-morans-i" class="level5">
<h5 class="anchored" data-anchor-id="mapping-the-local-morans-i">6.3.2 Mapping the local Moran’s I</h5>
<p>Before mapping the local Moran’s I map, it is wise to append the local Moran’s I dataframe (i.e.&nbsp;localMI) onto nga_wp SpatialPolygonDataFrame. The code chunks below can be used to perform the task. The out SpatialPolygonDataFrame is called <em>nga_wp.localMI</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>nga.localMI <span class="ot">&lt;-</span> <span class="fu">cbind</span>(nga_wp,localMI)<span class="sc">%&gt;%</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Pr.Ii =</span> Pr.z....E.Ii..)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(nga.localMI) <span class="sc">+</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"Ii"</span>, </span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"pretty"</span>,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"RdBu"</span>,</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"local moran statistics"</span>) <span class="sc">+</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">legend.outside =</span> <span class="cn">TRUE</span>,</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.height =</span> <span class="fl">0.45</span>, </span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">5.0</span>,</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"bottom"</span>),</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take_home_Ex1_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The plot above shows that the regions of the top right of the country in blue has the most positive clusters, meaning percentage of non-functional water points in these regions are quite similar. Regions in pink have negative correlations, meaning percentage of non-functional water points in these regions are quite discrete.</p>
</section>
<section id="mapping-the-local-morans-p-values" class="level5">
<h5 class="anchored" data-anchor-id="mapping-the-local-morans-p-values">6.3.3 Mapping the local Moran’s p-values</h5>
<p>The choropleth shows there is evidence for both positive and negative Ii values. However, it is useful to consider the p-values for each of these values, as consider above.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(nga.localMI) <span class="sc">+</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"Pr.Ii"</span>, </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">breaks=</span><span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="cn">Inf</span>),</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette=</span><span class="st">"-Blues"</span>, </span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"local Moran's I p-values"</span>) <span class="sc">+</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">legend.outside =</span> <span class="cn">TRUE</span>,</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.height =</span> <span class="fl">0.45</span>, </span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">5.0</span>,</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"bottom"</span>),</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take_home_Ex1_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The figure above shows clearly regions having distinct cluster or outlier patterns, instead of randomly distributed one. Regions in more deep color, the cluster or outlier pattern is more significant.</p>
</section>
<section id="creating-a-lisa-cluster-map" class="level5">
<h5 class="anchored" data-anchor-id="creating-a-lisa-cluster-map">6.3.4 Creating a LISA Cluster Map</h5>
<p>The LISA Cluster Map shows the significant locations color coded by type of spatial autocorrelation. The first step before we can generate the LISA cluster map is to plot the Moran scatterplot.</p>
<section id="plotting-moran-scatterplot" class="level6">
<h6 class="anchored" data-anchor-id="plotting-moran-scatterplot">6.3.4.1 Plotting Moran scatterplot</h6>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>nci<span class="ot">&lt;-</span> <span class="fu">moran.plot</span>(nga_wp<span class="sc">$</span><span class="st">`</span><span class="at">pct_non-functional</span><span class="st">`</span>, rswm_f,</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">labels=</span><span class="fu">as.character</span>(nga_wp<span class="sc">$</span>shapeName),</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">zero.policy =</span> <span class="cn">TRUE</span>,</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">xlab=</span><span class="st">"Pct non-functional"</span>, </span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylab=</span><span class="st">"Sptially Lag Pct non-functional"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take_home_Ex1_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Notice that the plot is split in 4 quadrants. The top right corner belongs to areas that have high percentage of non-functional water point and are surrounded by other areas that have the average level of pct_non-functional, i.e.&nbsp;the high-high locations.</p>
</section>
<section id="plotting-moran-scatterplot-with-standardised-variable" class="level6">
<h6 class="anchored" data-anchor-id="plotting-moran-scatterplot-with-standardised-variable">6.3.4.2 Plotting Moran scatterplot with standardised variable</h6>
<p>First we will use <a href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/scale"><em>scale()</em></a> to centers and scales the variable. Here centering is done by subtracting the mean (omitting NAs) the corresponding columns, and scaling is done by dividing the (centered) variable by their standard deviations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>nga_wp<span class="sc">$</span>z.pctnon <span class="ot">&lt;-</span> <span class="fu">scale</span>(nga_wp<span class="sc">$</span><span class="st">`</span><span class="at">pct_non-functional</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  as.vector </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, we are ready to plot the Moran scatterplot again by using the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>nci2 <span class="ot">&lt;-</span> <span class="fu">moran.plot</span>(nga_wp<span class="sc">$</span>z.pctnon, rswm_f,</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">labels=</span><span class="fu">as.character</span>(nga_wp<span class="sc">$</span>shapeName),</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">zero.policy =</span> <span class="cn">TRUE</span>,</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">xlab=</span><span class="st">"Pct non-functional"</span>, </span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylab=</span><span class="st">"Sptially Lag Pct non-functional"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take_home_Ex1_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="section" class="level6">
<h6 class="anchored" data-anchor-id="section"></h6>
<p>6.3.4.3 Preparing LISA map classes</p>
<p>The code chunks below show the steps to prepare a LISA cluster map.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>quadrant <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode=</span><span class="st">"numeric"</span>,<span class="at">length=</span><span class="fu">nrow</span>(localMI))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, derives the spatially lagged variable (pct_non-functional) and centers the spatially lagged variable around its mean.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>nga_wp<span class="sc">$</span>lag_pctnon <span class="ot">&lt;-</span> <span class="fu">lag.listw</span>(rswm_f, nga_wp<span class="sc">$</span><span class="st">`</span><span class="at">pct_non-functional</span><span class="st">`</span>,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>DV <span class="ot">&lt;-</span> nga_wp<span class="sc">$</span>lag_pctnon <span class="sc">-</span> <span class="fu">mean</span>(nga_wp<span class="sc">$</span>lag_pctnon)     </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is follow by centering the local Moran’s around the mean.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>LM_I <span class="ot">&lt;-</span> localMI[,<span class="dv">1</span>] <span class="sc">-</span> <span class="fu">mean</span>(localMI[,<span class="dv">1</span>])    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will set a statistical significance level as 95% for the local Moran.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>signif <span class="ot">&lt;-</span> <span class="fl">0.05</span>       </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>These four command lines define the low-low (1), low-high (2), high-low (3) and high-high (4) categories.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>quadrant[DV <span class="sc">&lt;</span><span class="dv">0</span> <span class="sc">&amp;</span> LM_I<span class="sc">&gt;</span><span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>quadrant[DV <span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">&amp;</span> LM_I<span class="sc">&lt;</span><span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>quadrant[DV <span class="sc">&lt;</span><span class="dv">0</span> <span class="sc">&amp;</span> LM_I<span class="sc">&lt;</span><span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">3</span>  </span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>quadrant[DV <span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">&amp;</span> LM_I<span class="sc">&gt;</span><span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">4</span>      </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Lastly, places non-significant Moran in the category 0.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>quadrant[localMI[,<span class="dv">5</span>]<span class="sc">&gt;</span>signif] <span class="ot">&lt;-</span> <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="plotting-lisa-map" class="level5">
<h5 class="anchored" data-anchor-id="plotting-lisa-map">6.3.5 Plotting LISA map</h5>
<p>Now, we can build the LISA map by using the code chunks below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>nga.localMI<span class="sc">$</span>quadrant <span class="ot">&lt;-</span> quadrant</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#ffffff"</span>, <span class="st">"#2c7bb6"</span>, <span class="st">"#abd9e9"</span>, <span class="st">"#fdae61"</span>, <span class="st">"#d7191c"</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>clusters <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"insignificant"</span>, <span class="st">"low-low"</span>, <span class="st">"low-high"</span>, <span class="st">"high-low"</span>, <span class="st">"high-high"</span>)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(nga.localMI) <span class="sc">+</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"quadrant"</span>, </span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"cat"</span>, </span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> colors[<span class="fu">c</span>(<span class="fu">sort</span>(<span class="fu">unique</span>(quadrant)))<span class="sc">+</span><span class="dv">1</span>], </span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">labels =</span> clusters[<span class="fu">c</span>(<span class="fu">sort</span>(<span class="fu">unique</span>(quadrant)))<span class="sc">+</span><span class="dv">1</span>],</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">popup.vars =</span> <span class="fu">c</span>(<span class="st">""</span>)) <span class="sc">+</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_view</span>(<span class="at">set.zoom.limits =</span> <span class="fu">c</span>(<span class="dv">11</span>,<span class="dv">17</span>)) <span class="sc">+</span></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha=</span><span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take_home_Ex1_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The map above shows that percentages of non-functional water points in areas in red are high and clustered; percentages in deep blue are low and sparsed; percentages in light blue are low outliers among high neighbours; percentages in orange are high outliers among low neighbours.</p>
</section>
</section>
</section>
<section id="hot-spot-and-cold-spot-area-analysis" class="level3">
<h3 class="anchored" data-anchor-id="hot-spot-and-cold-spot-area-analysis">7. Hot Spot and Cold Spot Area Analysis</h3>
<p>Beside detecting cluster and outliers, localised spatial statistics can be also used to detect hot spot and/or cold spot areas. Spatial statistics to detect spatial anomalies is the Getis and Ord’s G-statistics</p>
<p>The analysis consists of three steps:</p>
<ul>
<li><p>Deriving spatial weight matrix</p></li>
<li><p>Computing Gi statistics</p></li>
<li><p>Mapping Gi statistics</p></li>
</ul>
<section id="gi-statistics-using-fixed-distance" class="level4">
<h4 class="anchored" data-anchor-id="gi-statistics-using-fixed-distance">7.1 Gi statistics using fixed distance</h4>
<p>First, <em>nb2listw()</em> is used to convert the nb object into spatial weights object. Because we produce <em>wm_d72</em> with <em>style-“W”,</em> we still use W to convert the object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>wm72_lw <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(wm_d72, <span class="at">style =</span> <span class="st">'W'</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(wm72_lw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Characteristics of weights list object:
Neighbour list object:
Number of regions: 774 
Number of nonzero links: 18112 
Percentage nonzero weights: 3.023323 
Average number of links: 23.40052 
Link number distribution:

 1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 
 5  8 12 21 32 35 33 35 28 36 25 21 19 23 16 14 10 13 15 17 16 11 13 10  6 12 
27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 
12  5 16 13 12  7  9  9 12  7 12 15 13  9 10  4  5  4  7  8  8  8  6  5  3  2 
53 54 55 56 57 58 59 60 61 62 63 64 65 67 68 70 
 3  4  5  3  6  5  2  6  4  8  8  4  4  3  1  1 
5 least connected regions:
90 112 123 237 670 with 1 link
1 most connected region:
585 with 70 links

Weights style: W 
Weights constants summary:
    n     nn  S0       S1       S2
W 774 599076 774 129.7549 3127.064</code></pre>
</div>
</div>
<p>From the summary above, we can see 5 regions have least neighbour of 1, and 1 region has most neighbours of 70. Then we compute the Gi statistics with below code chunk.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>fips <span class="ot">&lt;-</span> <span class="fu">order</span>(nga_wp<span class="sc">$</span>shapeName)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>gi.fixed <span class="ot">&lt;-</span> <span class="fu">localG</span>(nga_wp<span class="sc">$</span><span class="st">`</span><span class="at">pct_non-functional</span><span class="st">`</span>, wm72_lw)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>gi.fixed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] -2.84259207 -2.66731121 -2.92536552  1.06373264 -5.35971822 -2.34676750
  [7] -1.94678384 -0.50953167 -3.69757876 -6.27664616  2.14387133  0.78754614
 [13] -0.72710486 -2.42675507  0.15904431 -1.86465812 -0.76452052 -4.31002136
 [19] -5.04744942  1.15614308 -1.88052920 -0.58461673 -6.79251935  0.04600987
 [25] -7.47923478  1.60541787  1.20405806 -1.31397136 -0.84954347 -2.04358755
 [31] -1.17464961 -0.02996123  7.14078949 -3.37824093 -1.25081713  0.30913817
 [37] -1.39308150 -1.70095183 -1.71611059 -0.82874688 -0.97188637 -3.32717788
 [43]  3.47858170 -1.53769876 -1.98336992  0.20811212  6.24401302  0.08597070
 [49] -0.33523848 -0.66513610  0.02098323 -6.41101105 -5.36239908 -6.80251723
 [55]  0.03321670 -5.97634669 -4.03599304 -4.72905375  1.62718104 -2.91420658
 [61] -2.26896680  0.35393788 -0.15674211  0.47357959  0.57007090 -5.35358307
 [67]  0.03840016  1.76823039 -1.58945482 -1.33702223 -1.94761491 -0.64325442
 [73] -0.49566029  1.29202624  5.58076966 -1.38572856 -6.60072118 -6.49786361
 [79] -6.83332755 -5.27412734  5.44947159  0.78006508  3.79989637 -1.55247659
 [85]  7.89219584 -3.07869093  3.54215334  1.42290728  2.95554329 -0.43736013
 [91] -3.58515217 -1.47549420 -0.78972124 -1.37885398  0.61089956  3.86092287
 [97]  3.38838529  2.23389847  4.35893766  1.93686177  7.03396074 -1.48227171
[103] -6.58466640 -4.00699399  7.96194248  0.67343069  1.35396107  4.15754173
[109]  1.10374347  4.61472373  5.41996549 -1.09979177  0.03914683  3.26291762
[115]  1.40095273  1.73435298 -0.27092664 -2.26384043 -0.90719985 -1.41436299
[121] -1.78257238  0.30027509  0.28209259 -1.20978673  0.68076413 -0.29332997
[127]  5.28109657  1.22257008  2.55400970  7.60422115 -0.16010490  3.22865677
[133] -1.84892620 -2.37855929  0.86502863 -3.64507623 -3.58908015  1.03547974
[139]  4.81561297  0.14637178  0.88873397  8.38618807 -0.82533462  2.51243734
[145]  7.36816180  0.48446547  4.55670468 -0.74078346  2.39096824  2.15527343
[151]  3.40175938  1.13733716  1.55246300  4.12980342  8.26191420  7.82693618
[157]  2.71063067 -1.86915893  3.09257540 -4.63443421  2.81095237 -1.43324913
[163] -0.82670923 -0.61335382 -6.89663436  6.03308614  4.08110724  4.95327919
[169] -1.80368743 -2.10754120  1.17516358 -1.54054687 -1.21113423  0.95281548
[175] -1.78930110 -1.14917093 -0.46399607 -1.55947522 -1.22201047 -1.49596627
[181] -7.72800760 -0.77228792 -1.19870685 -4.59584621 -2.26898924 -2.36336878
[187] -1.84163027 -1.96672109 -5.98332267 -0.40688334  1.33810942 -1.76161133
[193] -4.65968457 -5.24833014 -5.51320955 -0.37916943 -1.15631088 -1.44179676
[199] -2.29960691 -1.06909703 -1.07072239 -3.97800188 -4.88850305 -2.15384065
[205] -2.03543186 -1.32554785 -0.69329930 -3.37776343 -4.62019188 -2.36991353
[211] -1.80264771 -2.23286439 -1.47031409 -0.44096750 -6.17789975 -6.75522324
[217] -3.15757035 -3.40792641  8.19856926 -0.15959283  2.80400934  0.96137898
[223]  2.23391695  0.10009772  3.20490401  2.25388324  8.00647156 -0.29435266
[229]  5.50718511  3.86906216  2.11138366  1.40967240  5.97353663  6.62546523
[235]  7.35324195  0.24276115  0.35137935  7.19442327  1.21328782 -1.35861169
[241]  0.87127905  8.39046868  2.76064838  2.42830922  2.10078716 -0.31110859
[247] -0.31641629  3.06141913  2.24529955 -3.18995660  0.07992527  0.88552817
[253]  0.87369067 -1.12769264  5.54082161  1.14949979  0.48537668  4.58181268
[259]  2.30986213  3.27932402 -5.08007673  1.37318188  0.82392856  8.21806273
[265]  0.88683949  3.40263183  7.44107764 -0.88793102 -1.35429967  4.59280012
[271] -1.78927690  6.15567094  2.69197914  0.71553665 -1.57333709 -1.44063818
[277] -1.72009265 -1.76440212 -2.00591423 -3.64328982 -1.50396553 -1.54359800
[283] -1.56758064  0.12058575 -3.99246547 -5.07984460 -1.19263814 -5.94004710
[289] -2.24425379 -1.25106108 -7.46833694 -7.45196281 -6.22388023 -5.96817441
[295] -1.77101711 -1.74747343 -0.33526336 -1.59006022 -1.41233714 -1.68632479
[301] -1.79972608 -1.96762168 -1.86816451 -0.58062646 -0.98963784 -0.27399953
[307]  0.20182830 -3.27506719 -3.93368223 -2.91472158 -3.57339172 -0.95609970
[313] -6.44044728 -7.64623793 -2.00216830 -1.54316781 -1.18386165 -0.60888583
[319] -1.69854305 -1.24897402 -3.15665148 -3.44129406 -1.75911942  3.97294741
[325] -7.11533335 -0.20869507 -0.38925241 -1.77824716 -2.22736900 -2.07515109
[331] -5.66668473 -0.26527499 -2.08564547 -5.31872671 -1.27802102 -0.26862448
[337] -3.00063175 -6.27854699 -1.56826979 -1.43815559 -1.28388789 -2.00613052
[343] -1.82349284 -1.73375488  1.21740232  0.24635668 -0.19354737 -0.03109913
[349] -0.93260627  5.24067894 -5.87878771  0.23167052 -1.08942149 -0.38342940
[355] -1.38260723 -1.16367905 -1.85416308 -1.40361200  1.29038066 -2.12286691
[361] -0.86939751 -4.07529060 -3.03657958 -4.89347186 -6.37836424 -7.81699468
[367] -1.55458147 -7.31884876 -1.38342626 -1.15083193 -0.81646019 -6.96160716
[373]  4.61323420 -1.21473996 -5.51904323 -6.55443146 -1.42851831 -0.89082867
[379] -2.25937663  1.03549426  2.20217342  6.70744433  3.36967854  0.35896524
[385]  5.33038893 -0.09654523  0.52628184 -0.72896628  2.85467011  0.34033777
[391] -0.46412743 -0.74736642 -0.88096901  8.22053233  0.67504841 -0.16291655
[397] -1.09900628  5.43166910  4.97021076 -0.23750785  0.65852863 -0.73002512
[403]  2.21826614 -1.68523892  1.87628797 -3.58515217  0.08030165  2.09073694
[409]  0.99911071  4.76535616  0.40914996  5.58277256  8.24345644  3.59087910
[415]  7.22991882 -0.06740592  1.00421262  3.50484660  1.43801299  2.89052519
[421] -1.76140222  5.31675890 -0.57633242  2.48780539  1.02149360  5.68289295
[427] -0.07746382  0.13686040  0.47927829 -1.52080342  6.75401095  0.37394083
[433]  5.27740704  6.60010994  5.87443038  0.58261920  0.01856432  1.15232588
[439] -0.31216388 -2.47693085 -1.35626092 -0.43097800 -0.29250437  3.27518910
[445]  3.15768220  1.00508960 -3.58515217  8.20768890  7.49794935  8.05304424
[451]  4.53555253 -0.29157406  5.87650880  0.72068265 -0.63360895 -1.74711228
[457]  1.37542820  2.21516236 -0.28932562 -1.44419996 -0.33796441 -0.32890857
[463]  1.74610553 -1.33063181 -1.03300707  0.07309674  2.09083384  0.77126898
[469]  2.18303361 -1.39125155 -0.49051625  3.96385886 -0.91461858  7.68229664
[475] -2.62901613 -0.06877459 -2.47696177  2.73386267 -1.01286206  5.14631655
[481] -1.01967820 -0.53012930  7.27220995 -1.69408759  5.89841835  5.34194971
[487] -1.08357527  4.09535846  3.16012370  0.35019039  3.87213535 -4.14246793
[493]  1.45126453  0.61294158  2.80850124  5.74490503  2.36780115 -6.70452829
[499] -3.80754756 -2.42625231  6.23043573 -1.37237396  7.73881597  1.97780907
[505] -3.08526048 -1.79690909 -2.92536552  1.20628041 -5.08007673 -0.94285799
[511]  0.66752543  0.12854654  1.06761081  5.93027724 -0.30547530  0.48065476
[517]  0.19796770  2.44931727  8.58789888 -0.16324519  0.99533426 -3.39967902
[523] -3.25651535  1.16104408 -4.14246793 -2.45438769 -0.44278778 -4.23236923
[529]  3.99778750  3.28366912 -7.29340082 -6.68652113 -4.72269794 -5.57151966
[535] -7.50890615 -6.66219978 -6.72946833 -4.49213464 -5.05923130 -4.49282870
[541] -3.53443863  2.17027420 -7.27802073 -0.26259875 -2.08611580 -2.43636121
[547] -0.10861720 -3.57221917  0.79990205 -1.76181492 -5.78213820 -7.53715997
[553] -2.83437150 -2.24918685 -2.22157705 -0.98738850 -0.96536284 -0.29553765
[559] -5.06791214 -0.75446202 -2.65807798 -3.01698817 -2.82425211 -5.71909345
[565]  0.67843193 -0.40626079 -0.32634994 -0.56670208 -2.12026991 -1.13368635
[571] -0.20706887 -1.91825697 -5.80045989 -5.01023246 -4.77199103 -4.62309433
[577] -2.34349845 -2.54286591 -7.29722121  0.61461839 -2.40270373 -1.93213870
[583] -0.46169883 -0.99028437 -7.89107769 -1.49763523 -4.45999215 -2.43368228
[589] -2.48540689  0.06307739 -0.78068682 -3.68503211 -0.98356054  0.28512012
[595] -1.88225984 -1.49988840 -2.42868376 -1.45077594 -1.43619106 -1.57901364
[601] -4.26515365 -6.38811231 -6.29473011 -4.10536899 -0.93994305 -1.58777473
[607] -0.39799575 -1.32580236 -0.36503140 -1.91793245 -7.01011997 -0.96635010
[613] -4.16438340 -6.87571113 -6.61842824 -6.56559499 -2.96819253 -6.97403523
[619] -7.43130815 -0.42450405 -5.42117410 -6.29465369 -0.20886522 -3.41214115
[625] -1.54174482 -1.60455805 -1.35179527 -1.26150118 -1.72606358 -1.15945015
[631] -6.09018617 -6.19718870 -5.45863752 -0.84952010 -2.13565321 -6.60378368
[637] -1.74424231 -0.73621295 -0.10929803 -0.73016426  1.10377283 -0.81085938
[643] -0.64124267 -0.20399514  0.49597120  1.31706952 -1.24998469  2.14699484
[649]  0.75988732  7.02863472 -0.28115293  0.55733894  3.72009276  7.96789936
[655]  7.10635766 -0.34340829  4.83660151  6.17694786  2.09298327  1.21815043
[661]  1.82984512  3.90467552 -0.54595461  0.31127502 -0.90653009 -0.29369514
[667]  4.06030972 -0.09338963 -1.88205425 -0.10741990 -0.17050978  1.41291268
[673]  0.20621059  2.39145304  7.89061896  3.81232728 -1.25468485  1.59412298
[679]  3.81536857 -0.11589868  0.62526319 -0.15632111  0.82119408  1.99850629
[685]  1.10157177  1.09008258  2.85197103 -1.56734180  4.78590168  0.19096237
[691]  4.96226920 -0.47869936 -0.43433392 -0.48148486 -0.00740191  0.45345434
[697] -0.74886025  5.19231849 -1.41504071  2.32739643  1.26723670  1.31082698
[703]  8.19330455 -1.88738794  0.99065733  6.92696747  7.92319845  0.78146133
[709] -0.98483658  0.34958799  2.82746355  7.61752135  5.12878876  2.40068842
[715] -3.15046761 -5.87415087 -2.50526783 -3.84572538 -1.56391368 -2.28100043
[721] -2.20281191 -1.40617351 -3.01834767 -1.17947521 -2.42757431 -1.90619783
[727] -2.21265835 -7.54674739 -7.21771393 -7.00948079  8.34383312 -8.05064736
[733] -5.28241866 -4.16869944 -1.91815106 -1.15239716 -2.78710667 -5.19131720
[739] -3.73208070 -2.28295923  1.68555013 -1.01143553  8.33551505  3.70334515
[745] -1.54732124 -1.95669485 -1.61289782  1.02457632 -1.50752843  7.64635478
[751] -0.90212818  1.49327651  1.50891665  1.37832152 -1.27345629 -1.54071490
[757] -3.34197882 -1.72015313  0.97383194  4.46135973 -0.34801760  0.85479804
[763]  3.21137535  3.68325018  1.21958183 -0.53090204  2.43065891  4.09416245
[769]  3.13501147  0.20936064  2.12259830  1.72908786  3.05072564  1.36733319
attr(,"cluster")
  [1] Low  Low  Low  Low  Low  Low  Low  High High Low  High Low  Low  Low  Low 
 [16] Low  Low  Low  Low  High Low  High Low  High Low  Low  High Low  High Low 
 [31] Low  High High Low  Low  Low  Low  Low  Low  Low  Low  Low  High Low  High
 [46] High High High High High High Low  Low  Low  Low  Low  Low  High High Low 
 [61] Low  Low  High High High Low  High High High Low  Low  Low  Low  High High
 [76] High Low  Low  Low  Low  High Low  High High High Low  High High High High
 [91] Low  Low  High Low  Low  High High High High High High Low  Low  Low  High
[106] High Low  High Low  High High Low  High High High High High Low  Low  Low 
[121] Low  High High Low  High Low  High High High High Low  High Low  Low  Low 
[136] Low  Low  Low  High High Low  High High Low  High Low  High Low  High High
[151] High High High Low  High High High Low  High Low  High High Low  Low  High
[166] High High High Low  Low  High High Low  Low  Low  Low  High Low  Low  Low 
[181] Low  High Low  High Low  High Low  Low  Low  High High Low  High High Low 
[196] Low  Low  Low  Low  Low  Low  Low  Low  Low  Low  Low  High Low  Low  Low 
[211] Low  High Low  Low  Low  Low  Low  Low  High High High High High Low  High
[226] High High High High High High High High High High Low  Low  High High Low 
[241] Low  High High High Low  High Low  High Low  Low  Low  Low  High Low  High
[256] High Low  High High High Low  High High High High High High Low  Low  High
[271] Low  High High High High High High High High Low  Low  Low  Low  Low  Low 
[286] Low  High Low  Low  Low  Low  Low  Low  Low  High Low  High Low  Low  Low 
[301] Low  Low  Low  High Low  Low  Low  Low  Low  Low  Low  Low  Low  Low  Low 
[316] Low  Low  High Low  Low  Low  High Low  High Low  High Low  Low  Low  Low 
[331] Low  High Low  Low  Low  High Low  Low  Low  Low  Low  Low  Low  Low  Low 
[346] High High High Low  High Low  Low  Low  Low  Low  Low  Low  Low  High High
[361] Low  Low  Low  Low  Low  Low  High Low  Low  Low  Low  Low  High High Low 
[376] Low  Low  High Low  Low  High High High Low  High High Low  High High Low 
[391] High Low  Low  High High Low  High High High Low  Low  High High Low  High
[406] Low  Low  High Low  High Low  High High High High Low  High High Low  High
[421] Low  High High High High High Low  High High High High Low  High High High
[436] Low  Low  High High High Low  High High High Low  Low  Low  High High High
[451] High Low  High High Low  Low  High High High Low  High High High Low  Low 
[466] High Low  High High Low  High High Low  High Low  High High High High High
[481] High Low  High High High High Low  High High Low  High Low  High Low  High
[496] High High Low  Low  High High Low  High High Low  Low  Low  High Low  Low 
[511] High Low  Low  High High High Low  High High Low  High Low  Low  Low  Low 
[526] Low  High Low  High High Low  Low  Low  Low  Low  Low  Low  Low  Low  Low 
[541] Low  High Low  Low  Low  Low  Low  Low  High High Low  Low  Low  Low  Low 
[556] Low  Low  High Low  Low  Low  High Low  Low  High High Low  High Low  Low 
[571] High High Low  Low  High Low  Low  Low  Low  Low  High Low  Low  High Low 
[586] Low  Low  Low  Low  High High Low  High Low  Low  Low  High Low  Low  Low 
[601] Low  Low  Low  Low  High High Low  Low  Low  Low  Low  Low  High Low  Low 
[616] Low  Low  Low  Low  Low  High Low  High Low  High Low  High High High Low 
[631] High Low  Low  Low  Low  Low  High Low  Low  Low  High Low  Low  High High
[646] High Low  High High High Low  Low  High High High Low  High High High Low 
[661] Low  High Low  High Low  Low  High High Low  Low  Low  High Low  High High
[676] High Low  High High High High High High High High High High Low  High High
[691] High Low  High Low  High High Low  High Low  High Low  Low  High High High
[706] High High High High High High High High Low  Low  Low  High Low  High Low 
[721] Low  High Low  Low  Low  Low  Low  Low  Low  Low  High Low  Low  Low  Low 
[736] Low  Low  Low  Low  Low  High High High High Low  Low  Low  High Low  High
[751] Low  High High Low  Low  Low  High Low  Low  High Low  Low  High Low  High
[766] High High High High High High High High High
Levels: Low High
attr(,"gstari")
[1] FALSE
attr(,"call")
localG(x = nga_wp$`pct_non-functional`, listw = wm72_lw)
attr(,"class")
[1] "localG"</code></pre>
</div>
</div>
<p>Next, we join the Gi values to their corresponding sf data frame by using the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>nga.gi <span class="ot">&lt;-</span> <span class="fu">cbind</span>(nga_wp, <span class="fu">as.matrix</span>(gi.fixed)) <span class="sc">%&gt;%</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">gstat_fixed =</span> as.matrix.gi.fixed.)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="mapping-gi-values-with-fixed-distance-weight" class="level4">
<h4 class="anchored" data-anchor-id="mapping-gi-values-with-fixed-distance-weight">7.2 Mapping Gi values with fixed distance weight</h4>
<p>The code chunk below shows the functions used to map the Gi values derived using fixed distance weight matrix.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>rmp <span class="ot">&lt;-</span> <span class="fu">qtm</span>(nga_wp,<span class="st">"pct_non-functional"</span>)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>Gimap <span class="ot">&lt;-</span><span class="fu">tm_shape</span>(nga.gi) <span class="sc">+</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"gstat_fixed"</span>, </span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"pretty"</span>,</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette=</span><span class="st">"-RdBu"</span>,</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"local Gi"</span>) <span class="sc">+</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(rmp, Gimap, <span class="at">asp=</span><span class="dv">1</span>, <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Take_home_Ex1_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>From figures above, it is shown that areas in the north of the country, more specifically areas in red, is a cluster of high values of percentage of non-functional water point; while areas in the south and north east of the country, more specifically areas in deep blue, are the opposite of clusters with low values of percentage of non-functional water point.</p>


</section>
</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>